# Docker registry behind nginx SSL proxy role with InSpec tests run by KitchenCI

## Docker Client

Repository also contains `docker-client` role which configures host to connect to insecure docker registry.

## Requirements

- Virtual Box
- Vagrant
- Chef Development Kit

## Options

- to provide custom SSL certificate, replace `cert.crt` and `cert.key` files under `roles\docker-registry\files`  
and set `user_provided_certificate` in `roles/docker-registry/vars/main.yml` to `true`
- if `user_provided_certificate` in `roles/docker-registry/vars/main.yml` is set to `false`,  
self-signed SSL certificate will be autogenerated

## Notable commands

### KitchenCI

- `kitchen create` - create virtual machine
- `kitchen converge` - provision created instance with Ansible playbook
- `kitchen verify` - run InSpec tests against provisioned instance
- `kitchen destroy` - destroy virtual machine
- `kitchen test` - same as running `kitchen destroy` (if instance exists) > `kitchen create` > `kitchen converge` > `kitchen verify` > `kitchen destroy`
- `kitchen login` - connect to virtual machine via SSH

### Vagrant

- `vagrant up` - create virtual machine and provision it with Ansible playbook
- `vagrant ssh` - login into virtual machine
